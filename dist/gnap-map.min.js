!function(){"use strict";angular.module("gnapMap",["gnap","ui.select"])}(),function(){"use strict";function a(){function a(a){function c(){return b?b:(a.log("No layers were configured. Use the 'setDataLayers' function at config time, or to expand it at run time."),{})}return{setDataLayers:function(a){angular.merge(b||{},a)},getDataLayers:c}}var b;this.setDataLayers=function(a){b=a},this.$get=a,a.$inject=["$log"]}angular.module("gnapMap").provider("layerConfig",a)}(),function(){"use strict";function a(a,b){function c(c,d,e,f){function g(){k.layer.displayLayer&&(b.fetchDataInBounds(k.layer,{refresh:"true"===c.layerRefresh||c.layerRefresh===!0?!0:!1,append:"true"===c.layerAppend||c.layerAppend===!0?!0:!1}),c.linkedLayers&&angular.forEach(c.linkedLayers.split(","),function(a){b.fetchDataInBounds(b.dataLayers[a],{refresh:"true"===c.linkedLayersRefresh||c.linkedLayersRefresh===!0?!0:!1,append:"true"===c.linkedLayersAppend||c.linkedLayersAppend===!0?!0:!1})}))}function h(){i(),k.layer.displayLayer?(g(),l=a(g,c.interval||5e3)):b.fetchDataInBounds(k.layer)}function i(){l&&(a.cancel(l),l=null)}function j(){return!c.alwaysEnabled&&b.mapView.viewPort.getZoomLevel()<k.layer.minZoomLevel}var k=c.vm={};k.layer=b.dataLayers[c.layer],k.muteDisplayOption=j;var l;c.$watch(function(){return c.interval},function(a,b){a!==b&&h()}),c.$watch(function(){return k.layer.displayLayer},function(){h()}),d.on("$destroy",function(){i()})}var d=b.config.translationLocationBase;return{restrict:"AE",link:c,scope:{layer:"@",layerRefresh:"=?",layerAppend:"=?",linkedLayers:"@",linkedLayersRefresh:"=?",linkedLayersAppend:"=?",interval:"=?",alwaysEnabled:"=?",hideIcon:"=?",hideLabel:"=?"},template:'<div ng-class="{ \'translucent\': vm.muteDisplayOption() }" class="layer-switch">    <label ng-if="vm.layer.iconUrl && !hideIcon" for="{{vm.layer.itemType}}"><img style="width: 20px" ng-src="{{vm.layer.iconUrl}}" /></label>    <input class="ace ace-switch ace-switch-3" type="checkbox" id="{{vm.layer.itemType}}" ng-model="vm.layer.displayLayer">    <span class="lbl"></span>    <label ng-hide="hideLabel" ng-class="{ \'text-muted\': vm.muteDisplayOption() }" for="{{vm.layer.itemType}}">        {{(vm.layer.translationId || \''+d+"' + vm.layer.itemType + 's') | translate}}    </label></div>"}}angular.module("gnapMap").directive("layerSwitchAutoRefresh",a),a.$inject=["$interval","mapManager"]}(),function(){"use strict";function a(a){function b(b,c,d,e){function f(){a.fetchDataInBounds(b.layer),d.linkedLayers&&angular.forEach(d.linkedLayers.split(","),function(b){a.fetchDataInBounds(a.dataLayers[b])})}function g(){return!b.alwaysEnabled&&a.mapView.viewPort.getZoomLevel()<h.layer.minZoomLevel}var h=b.vm={};h.layer=a.dataLayers[b.layer],h.fetchLayerDataInBounds=f,h.muteDisplayOption=g}var c=a.config.translationLocationBase;return{restrict:"AE",link:b,scope:{layer:"@",linkedLayers:"@",alwaysEnabled:"=?",hideIcon:"=?",hideLabel:"=?"},template:'<span ng-class="{ \'translucent\': vm.muteDisplayOption() }" class="layer-switch">    <label ng-if="vm.layer.iconUrl && !hideIcon" for="{{vm.layer.itemType}}"><img style="width: 20px" ng-src="{{vm.layer.iconUrl}}" /></label>    <input class="ace ace-switch ace-switch-3" type="checkbox" id="{{vm.layer.itemType}}" ng-model="vm.layer.displayLayer" ng-change=\'vm.fetchLayerDataInBounds()\'>    <span class="lbl"></span>    <label ng-hide="hideLabel" ng-class="{ \'text-muted\': vm.muteDisplayOption() }" for="{{vm.layer.itemType}}">        {{(vm.layer.translationId || \''+c+"' + vm.layer.itemType + 's') | translate}}    </label></span>"}}angular.module("gnapMap").directive("layerSwitch",a),a.$inject=["mapManager"]}(),function(){"use strict";function a(){function a(a,c){function d(d,e){var h=b+f(d),i=angular.extend({},g(d),e);return c.isDefaultCoordinateSystem()||(i.result=c.getCoordinateSystem()),a.get(h,{params:i})}function e(d){var e=b+f(d,!0),g={};return c.isDefaultCoordinateSystem()||(g.result=c.getCoordinateSystem()),a.get(e,{params:g})}var f=function(a,b){return a.resourceUri+(b?"/all":"")},g=function(a){return{}};return{setConstructResourceUriFunction:function(a){f=a},setConstructParamsFunction:function(a){g=a},getInBounds:d,getAll:e}}var b="http://localhost/";this.setEndpointUri=function(a){b=a},this.$get=a,a.$inject=["$http","mapTech"]}angular.module("gnapMap").provider("mapGeoData",a)}(),function(){"use strict";function a(){function a(a,e,f,g,h,i,j){function k(a){I.viewPort.getBounds()&&angular.forEach(C,function(b){q(b,a)})}function l(){angular.forEach(C,function(a){v(a)})}function m(){g.is(c)&&g.go(b)}function n(a,d){g.is(c)?g.go(b).then(function(){y(a,d)}):y(a,d)}function o(b,c){a.$emit("custom-shape-created",b,c)}function p(b){a.$emit("items-selected",b)}function q(a,b,c){var d=b===!0,e=!1,f=c;if(null!==b&&"object"==typeof b&&(d=b.refresh,e=b.append,f=b.callback),I.viewPort.getBounds()){"string"==typeof a&&(a=C[a]),"undefined"==typeof a.shouldShowFunction&&(a.shouldShowFunction=u);var g=a.shouldShowFunction(a,I.viewPort.getZoomLevel(),C);if((!g||d)&&v(a),g&&(!w(a)||a.getLabelStyleFunction||e||a.moving)){F.featuresLoading++;try{var h=a.cache&&!G.skipCache?s:r;h(a,d)["finally"](function(){F.featuresLoading--,"function"==typeof f&&f()})}catch(i){F.featuresLoading--}}}}function r(a,b){return i.getInBounds(a,I.viewPort.getBoundsWgs84()).then(function(c){var d=I.viewPort.getZoomLevel();a.shouldShowFunction(a,d,C)&&(x(c.data,b),a._zoom=d)})}function s(a,b){return"undefined"==typeof a._cache?i.getAll(a).then(function(c){a._cache=c.data;var d=I.viewPort.getZoomLevel();a.shouldShowFunction(a,d,C)&&(t(a._cache,a.itemType,b),a._zoom=d)}):e(function(){t(a._cache,a.itemType,b)})}function t(a,b,c){var d={type:"FeatureCollection",features:[]},e=I.viewPort.getBounds(.5);angular.forEach(a.features,function(a){if(!a.geometry||!a.geometry.coordinates)throw new Error("Feature to add does not have 'geometry' or 'geometry.coordinates'");I.viewPort.containsCoordinate(a.geometry.coordinates,e)&&d.features.push(a)}),x(d,c)}function u(a,b,c){return a.displayLayer&&b>=a.minZoomLevel&&("undefined"==typeof a.maxZoomLevel||null===a.maxZoomLevel||b<=a.maxZoomLevel)}function v(a){I._removeGeoJsonData(a.itemType),a._fetchedItems=[]}function w(a){if(a.alwaysRefresh||a.refreshOnZoomChange&&a._zoom!==I.viewPort.getZoomLevel())return v(a),!1;a.hasOwnProperty("_fetchedItems")||(a._fetchedItems=[]);var b=!1;return a._fetchedItems.forEach(function(a){I.viewPort.isInBounds(a)&&(b=!0)}),b?!0:(a._fetchedItems.push(I.viewPort.getBounds()),!1)}function x(a,b){e(function(){F.featuresAdding++}).then(function(){e(function(){try{if(null===a.features||void 0===a.features)return;var c=null==a?0:a.features.length;if(c>0){var d=a.features[0].properties.type;I._addGeoJsonData(a,d,b),f.log("Added "+c+" "+d+"s.")}}finally{F.featuresAdding--}})})}function y(a,b){var d=C[a];if(d&&!d.hasNoDetails){if(b!==parseInt(b,10)){var e=b.indexOf("_");e>-1&&(b=parseInt(b.substr(e+1)))}var f={type:a,id:b};g.go(c,f)}}function z(a){D=a}function A(){return D}function B(){g.is(c)&&n(h.type,h.id)}var C=j.getDataLayers(),D={},E={type:null,position:null,details:null},F={featuresLoading:0,featuresAdding:0},G={skipCache:!1},H=function(){f.log("No implementation for this action was set by the selected map view!")},I={_addGeoJsonData:H,_removeGeoJsonData:H,addCustomKml:H,removeCustomKml:H,showInfoWindow:H,closeInfoWindow:H,resizeMap:H,activateDrawingMode:H,getGeoJson:H,viewPort:{getZoomLevel:H,setZoomLevel:H,getCenter:H,getCenterWgs84:H,setCenter:H,setCenterWgs84:H,getBounds:H,getBoundsWgs84:H,setBounds:H,setBoundsWgs84:H,containsBounds:H,containsCoordinate:H}};return a.$on("refreshDetailData",B),{dataLayers:C,selection:E,loadingStatus:F,fetchDataInBounds:q,fetchAllDataInBounds:k,clearData:v,clearAllData:l,mapFunctionIsSupported:function(a){return a!==H},mapView:I,events:{onInfoWindowClosed:m,onDataItemClicked:n,onCustomShapeCreated:o,onMultipleItemsSelected:p},setMap:z,getMap:A,settings:G,config:{mapState:b,mapInfoState:c,translationLocationBase:d}}}var b="main.map",c="main.map.info",d="main.common.";this.setMapState=function(a){b=a},this.setMapInfoState=function(a){c=a},this.setTranslationLocationBase=function(a){d=a},this.$get=a,a.$inject=["$rootScope","$timeout","$log","$state","$stateParams","mapGeoData","layerConfig"]}angular.module("gnapMap").provider("mapManager",a)}(),function(){"use strict";function a(a){function b(b){b.mapTechList=a.getAllMapTech(),b.mapTech=a.getSelectedMapTech(),b.setMapTech=function(b){a.setSelectedMapTechKey(b)}}return{restrict:"A",scope:{},link:b,template:'<a data-toggle="dropdown" class="dropdown-toggle">\n    <span>\n        {{mapTech.displayName}}\n    </span>\n    <i class="icon-caret-down"></i>\n</a>\n\n<ul class="user-menu pull-right dropdown-menu dropdown-default dropdown-caret dropdown-close">\n    <li ng-repeat="mapTech in mapTechList">\n        <a ng-click="setMapTech(mapTech.key)">\n            {{mapTech.displayName}}\n        </a>\n    </li>\n</ul>\n'}}angular.module("gnapMap").directive("mapTechSelector",a),a.$inject=["mapTech"]}(),function(){"use strict";function a(){function a(a){c(d)&&(e=a.key),d[a.key]=a}function b(a,b,f,g){function h(){return c(d)&&b.log("No map technology modules were registered. Install and reference a module (e.g. gnap-map-google)."),d}function i(a){return a?(d[a]||b.log("Map technology '"+a+"' was not registered. Install and reference the module (gnap-map-"+a+")."),d[a]):i(j())}function j(){return o||f.get("mapTech")||e}function k(b){o=b,f.set("mapTech",b),a.location.reload()}function l(a){return j()===a}function m(){var a=i();return a?a.coordinateSystem:g}function n(){return m()===g}var o=null;return{getAllMapTech:h,getMapTech:i,getSelectedMapTech:i,getSelectedMapTechKey:j,setSelectedMapTechKey:k,is:l,isDefaultCoordinateSystem:n,getCoordinateSystem:m}}function c(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}var d={},e=null;this.registerMapTech=a,this.$get=b,b.$inject=["$window","$log","localStorageService","defaultCoordinateSystem"]}angular.module("gnapMap").constant("defaultCoordinateSystem","wgs84").provider("mapTech",a)}(),function(){"use strict";function a(a){return d(a,[].slice.call(arguments,1),!0)}function b(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function c(a){return!(!a||!(a.nodeName||a.prop&&a.attr&&a.find))}function d(a,b,c){for(var f=a.$$hashKey,g=0,h=b.length;h>g;++g){var i=b[g];if(angular.isObject(i)||angular.isFunction(i))for(var j=Object.keys(i),k=0,l=j.length;l>k;k++){var m=j[k],n=i[m];c&&angular.isObject(n)?angular.isDate(n)?a[m]=new Date(n.valueOf()):angular.isRegExp(n)?a[m]=new RegExp(n):n.nodeName?a[m]=n.cloneNode(!0):angular.isElement(n)?a[m]=n.clone():(angular.isObject(a[m])||(a[m]=angular.isArray(n)?[]:{}),d(a[m],[n],!0)):a[m]=n}}return e(a,f),a}function e(a,b){b?a.$$hashKey=b:delete a.$$hashKey}angular.merge||(angular.merge=a),angular.isRegExp||(angular.isRegExp=b),angular.isElement||(angular.isElement=c)}();